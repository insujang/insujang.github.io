<!DOCTYPE html>
<html lang='en' ><meta charset="utf-8">
<meta name="viewport" content="width=device-width">


<title>Intel SGX Sealing | Better Tomorrow with Computer Science</title>
<link rel="stylesheet" href="/css/eureka.min.css">
<script defer src="/js/eureka.min.js"></script>

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload"
  href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Noto+Serif+SC:wght@400;600;700&display=swap"
  as="style" onload="this.onload=null;this.rel='stylesheet'">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.0/build/styles/solarized-light.min.css"
   media="print"
  onload="this.media='all';this.onload=null" crossorigin>
<script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.0/build/highlight.min.js"
   crossorigin></script>
<script defer src="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/js/all.min.js"
   integrity="sha256-uNYoXefWRqv&#43;PsIF/OflNmwtKM4lStn9yrz2gVl6ymo="  crossorigin></script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
   integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3&#43;Aro6EYUG4&#43;cU&#43;KJWu/X"  media="print"
  onload="this.media='all';this.onload=null" crossorigin>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" 
  integrity="sha384-g7c&#43;Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI&#43;sEnkvrMWph2EDg4"  crossorigin></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"
   integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC&#43;Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa"  crossorigin></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false },
        { left: "\\(", right: "\\)", display: false },
        { left: "\\[", right: "\\]", display: true }
      ],
    });
  });
</script>


<link rel="icon" type="image/png" sizes="32x32" href="/images/icon_hu64421c6c7700f606f0ad45d807017b09_5843_32x32_fill_box_center_2.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/icon_hu64421c6c7700f606f0ad45d807017b09_5843_180x180_fill_box_center_2.png">

<meta name="description"
  content="There is a few information related to sealing, even no detailed explanation in the paper: Intel SGX explaned.">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
      "@type": "ListItem",
      "position": 1 ,
      "name":"Posts",
      "item":"/posts/"},{
      "@type": "ListItem",
      "position": 2 ,
      "name":"Intel SGX Sealing",
      "item":"/2017-10-09/intel-sgx-sealing/"}]
}
</script>



<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "/2017-10-09/intel-sgx-sealing/"
    },
    "headline": "Intel SGX Sealing | Better Tomorrow with Computer Science","datePublished": "2017-10-09T15:26:34+09:00",
    "dateModified": "2017-10-09T15:26:34+09:00",
    "wordCount":  766 ,
    "publisher": {
        "@type": "Person",
        "name": "Insu Jang",
        "logo": {
            "@type": "ImageObject",
            "url": "/images/icon.png"
        }
        },
    "description": "There is a few information related to sealing, even no detailed explanation in the paper: Intel SGX explaned."
}
</script><meta property="og:title" content="Intel SGX Sealing | Better Tomorrow with Computer Science" />
<meta property="og:type" content="article" />


<meta property="og:image" content="/images/icon.png">


<meta property="og:url" content="/2017-10-09/intel-sgx-sealing/" />




<meta property="og:description" content="There is a few information related to sealing, even no detailed explanation in the paper: Intel SGX explaned." />




<meta property="og:locale" content="en" />




<meta property="og:site_name" content="Better Tomorrow with Computer Science" />






<meta property="article:published_time" content="2017-10-09T15:26:34&#43;09:00" />


<meta property="article:modified_time" content="2017-10-09T15:26:34&#43;09:00" />



<meta property="article:section" content="posts" />


<meta property="article:tag" content="research" />

<meta property="article:tag" content="sgx" />

<meta property="article:tag" content="io" />





<meta property="og:see_also" content="/2017-09-06/nvmedirect/" />

<meta property="og:see_also" content="/2017-06-01/implementing-and-using-custom-intel-sgx-trusted-library-2/" />

<meta property="og:see_also" content="/2017-05-31/implementing-and-using-custom-intel-sgx-trusted-library/" />

<meta property="og:see_also" content="/2017-04-21/hooking-an-sgx-encls-leaf-function-call-from-kvm/" />

<meta property="og:see_also" content="/2017-04-05/intel-sgx-instructions-in-enclave-initialization/" />

<meta property="og:see_also" content="/2017-04-03/intel-sgx-protection-mechanism/" />



<body class="flex flex-col min-h-screen">
  <header class="fixed flex items-center w-full min-h-16 pl-scrollbar z-50 bg-secondary-bg shadow-sm">
    <div class="w-full max-w-screen-xl mx-auto"><script>
    let storageColorScheme = localStorage.getItem("lightDarkMode")
    if ((storageColorScheme == 'Auto' && window.matchMedia("(prefers-color-scheme: dark)").matches) || storageColorScheme == "Dark") {
        document.getElementsByTagName('html')[0].classList.add('dark')
    }
</script>
<nav class="flex items-center justify-between flex-wrap p-4">
    <a href="/" class="mr-6 text-primary-text font-bold">Better Tomorrow with Computer Science</a>
    <button id="navbar-btn" class="md:hidden flex items-center px-3 py-2" aria-label="Open Navbar">
        <i class="fas fa-bars"></i>
    </button>

    <div id="target"
        class="hidden block md:flex md:flex-grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20">
        <div class="text-sm md:flex-grow pb-4 md:pb-0 border-b md:border-b-0">
            <a href="/#about"
                class="block mt-4 md:inline-block md:mt-0  hover:text-eureka mr-4">About</a>
            <a href="/posts/"
                class="block mt-4 md:inline-block md:mt-0  hover:text-eureka mr-4">Posts</a>
        </div>

        <div class="flex">
            <div class="relative pt-4 md:pt-0">
                <div class="cursor-pointer hover:text-eureka" id="lightDarkMode">
                    <i class="fas fa-sun"></i>
                </div>
                <div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id="is-open">
                </div>
                <div class="absolute flex flex-col left-0 md:left-auto right-auto md:right-0 hidden bg-secondary-bg w-48 rounded py-2 border border-tertiary-bg cursor-pointer z-40"
                    id='lightDarkOptions'>
                    <span class="px-4 py-1 hover:text-eureka">Light</span>
                    <span class="px-4 py-1 hover:text-eureka">Dark</span>
                    <span class="px-4 py-1 hover:text-eureka">Auto</span>
                </div>
            </div>
        </div>
    </div>

    <div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id="is-open-mobile">
    </div>

</nav>
<script>
    let element = document.getElementById('lightDarkMode')
    if (storageColorScheme == 'Auto') {
        element.firstElementChild.classList.remove('fa-sun')
        element.firstElementChild.setAttribute("data-icon", 'adjust')
        element.firstElementChild.classList.add('fa-adjust')
        document.addEventListener('DOMContentLoaded', () => {
            switchMode('Auto')
        })
    } else if (storageColorScheme == "Dark") {
        element.firstElementChild.classList.remove('fa-sun')
        element.firstElementChild.setAttribute("data-icon", 'moon')
        element.firstElementChild.classList.add('fa-moon')
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        getcolorscheme();
        switchBurger();
    });
</script></div>
  </header>
  <main class="flex-grow pt-16">
    <div class="pl-scrollbar">
      <div class="w-full max-w-screen-xl lg:px-4 xl:px-8 mx-auto">


<div class="grid grid-cols-2 lg:grid-cols-8 gap-4 lg:pt-12">
    <div
        class="col-span-2 lg:col-start-2 lg:col-span-6 bg-secondary-bg rounded px-6 py-8">
        <h1 class="font-bold text-3xl text-primary-text">Intel SGX Sealing</h1>
        <div class="mr-6 my-2">
    <span>Oct 9, 2017</span>
</div>




        
        
        

        <div class="content">
            <p>There is a few information related to sealing, even no detailed explanation in the paper: Intel SGX explaned.
All in this post are from Intel, with a little thought of mine.</p>
<h2 id="sealing">Sealing</h2>
<p>Sealing is a service that Intel provides with Intel SGX technology for secure data saving.<br>
Intel SGX provides protections data only if it is in the enclave, part of main memory.
Therefore, when the enclave process exits, the enclave will be destroyed and any data that is secured whithin the enclave will be lost.
If the data is meant to be re-used later, the enclave must make special arrangements to store the data outside the enclave.</p>
<p>Using sealing, the data within the enclave is encrypted using an encryption key that is derived from the CPU hardware. The encryption provides assurances of confidentiality, integrity, and authenticity on the data.</p>
<blockquote>
<p>Note: Like Intel SGX does, sealing does not provide availability to the sealed data.
Therefore, the data may be lost due to disk corruption, malicious modification (e.g. Ransomeware), etc.</p>
</blockquote>
<p>Intel SGX provides two policies for encryption keys: MRENCLAVE (enclave identity) and MRSIGNER (signing identity).
These policies affect the derivation of the encryption key, and this is partially explained in Intel SGX explained.</p>
<ul>
<li>Section 5.6. Enclave Measurement (MRENCLAVE)</li>
<li>Section 5.7.2. Certificate-Based Enclave identity (MRSIGNER)</li>
<li>Section 5.7.4. Establishing an Enclave&rsquo;s Identity</li>
</ul>
<h3 id="mrenclave">MRENCLAVE</h3>
<p>Derive a key based on the value of the enclave&rsquo;s MRENCLAVE. Any change that impacts the enclave&rsquo;s measurement will yield a different key, providing full isolation between enclaves.<br>
The paper also mentions that &ldquo;different versions of the same enclave will also have different seal keys, preventing offline data migration.&rdquo;
In other words, the MRENCLAVE-based keys are available only to enclave instances sharing the same MRENCLAVE.</p>
<h3 id="mrsigner">MRSIGNER</h3>
<p>Derive a key based on the value of the enclave&rsquo;s MRSIGNER, and the enclave&rsquo;s version. MRSIGNER reflects the <strong>key or identity of the Sealing Authority</strong> that signed the enclave&rsquo;s certificate.
The Sealing Authority may sign multiple enclaves and enable them to retrieve the same seal key. These enclaves can transparently access data that was sealed by the other.</p>
<p>While sealing with MRENCLAVE does not allow offline data migration between the same enclave with different versions, this allows limited data migration (only older version to newer version) or between different enclaves with the same Signing identity.</p>
<p>The MRSIGNER-based keys are bound to the 3 tuples (MRSIGNER, ISVPRODID, ISVSVN). The keys are available to any enclave with:</p>
<ul>
<li>the same MRSIGNER</li>
<li>the same ISVPRODID</li>
<li>and ISVSVN equal to or greather than the key in questions. (greather than the key means current enclave is a newer one.)</li>
</ul>
<blockquote>
<p>Here, <strong>different version</strong> seems to mean different <strong><mark>Security Version Number (SVN)</mark></strong>, which is explained in the paper Intel SGX explained (p79).</p>
<p><img src="/assets/images/171009/isvsvn.png" alt="isvsvn">{: .center-image width=&ldquo;400px&rdquo;}</p>
<p>Enclaves that represent different versions of a module
can have different security version numbers (SVN). The SGX design disallows the migration of secrets from an enclave with a higher SVN to an enclave with a lower SVN.</p>
<p>As users upgrade, SGX will facilitate the migration of secrets from the vulnerable version of the enclave to the fixed version. Once a user’s secrets have migrated, the SVN restrictions in SGX will deflect any attack based on building the vulnerable enclave version and using it to read the migrated secrets.</p>
<p>As explained above, a software module’s SVN should only be incremented when a security vulnerability is found. SIGSTRUCT only allocates 2 bytes to the ISVSVN field, which translates to 65,536 possible SVN values. This space can be exhausted if a large team (incorrectly) sets up a continuous build system to allocate a new SVN for every software build that it produces, and each code change triggers a build.</p>
</blockquote>
<h3 id="sdk-functions">SDK Functions</h3>
<p>Intel SGX SDK provides some functions for data sealing.</p>
<ul>
<li><code>sgx_seal_data_ex</code> / <code>sgx_unseal_data_ex</code> [<a href="https://software.intel.com/en-us/node/709129">ref</a>]</li>
<li><code>sgx_seal_data</code> / <code>sgx_unseal_data</code> [<a href="https://software.intel.com/en-us/node/709128">ref</a>]
Simplified version of <code>sgx_seal_data_ex</code>, which uses MRSIGNER policy by default.</li>
<li><code>sgx_calc_sealed_data_size</code> [<a href="https://software.intel.com/en-us/node/709125">ref</a>]
Reference code in [<a href="https://software.intel.com/en-us/forums/intel-software-guard-extensions-intel-sgx/topic/701485">here</a>]
uses the function to allocate memory space for sealed data.</li>
</ul>
<p>SDK function introduction is [<a href="https://software.intel.com/en-us/node/709048">here</a>].</p>
<p>A very simple example data sealing code is as follows.</p>
<pre><code class="language-c">sgx_status_t res;
uint8_t* plaintext = (uint8_t*) malloc(plaintext_len);
// Do something in plaintext memory space.

// Allocate space for sealing
uint32_t ciph_size = sgx_calc_sealed_data_size(0, plaintext_len);
uint8_t* sealed = (uint8_t*) malloc(ciph_size);
uint32_t plain_size = plaintext_len;

// Seal and unseal the data
res = sgx_seal_data(0, NULL, plaintext_len, plaintext, ciph_size, (sgx_sealed_data_t *) sealed);
assert(res == SGX_SUCCESS);

res = sgx_unseal_data((sgx_sealed_data_t *) sealed, NULL, NULL, plaintext, &amp;plain_size);
assert (res == SGX_SUCCESS);
</code></pre>
<h2 id="references">References</h2>
<ul>
<li>Innovative Technology for CPU Based Attestation and Sealing <a href="https://software.intel.com/sites/default/files/article/413939/hasp-2013-innovative-technology-for-attestation-and-sealing.pdf">[link]</a></li>
<li>Introduction to Intel(R) SGX Sealing <a href="https://software.intel.com/en-us/blogs/2016/05/04/introduction-to-intel-sgx-sealing">[link]</a></li>
<li>Intel 64 and IA-32 Architectures Software Developer&rsquo;s Manual Volume 3D: System Programming Guide, Part 4 <a href="https://software.intel.com/sites/default/files/managed/7c/f1/332831-sdm-vol-3d.pdf">[link]</a></li>
</ul>

        </div>
        
        <div class="my-4">
    
    <a href="/tags/research/" class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 mr-2 hover:text-eureka">#research</a>
    
    <a href="/tags/sgx/" class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 mr-2 hover:text-eureka">#sgx</a>
    
    <a href="/tags/io/" class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 mr-2 hover:text-eureka">#io</a>
    
</div>
        
        
        
        
        
        
        
<div class="flex flex-col md:flex-row md:justify-between -mx-2 mt-4 px-2 pt-4 border-t">
    <div>
        
        <span class="block font-bold">Previous</span>
        <a href="/2018-11-22/systemd-boot-process/" class="block">systemd Boot Process</a>
        
    </div>
    <div class="md:text-right mt-4 md:mt-0">
        
        <span class="block font-bold">Next</span>
        <a href="/2017-09-06/nvmedirect/" class="block">NVMeDirect</a>
        
    </div>
</div>

        

<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "insujang" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


    </div>
    

    
    
    <div
        class="col-span-2 lg:col-start-2 lg:col-span-6 bg-secondary-bg rounded p-6">
        <h2 class="text-lg font-semibold mb-4">See Also</h2>
        <div class="content">
            
            <a href="/2017-09-06/nvmedirect/">NVMeDirect</a>
            <br />
            
            <a href="/2017-06-01/implementing-and-using-custom-intel-sgx-trusted-library-2/">Implementing and Using Custom Intel SGX Trusted Library 2</a>
            <br />
            
            <a href="/2017-05-31/implementing-and-using-custom-intel-sgx-trusted-library/">Implementing and Using Custom Intel SGX Trusted Library</a>
            <br />
            
            <a href="/2017-04-21/hooking-an-sgx-encls-leaf-function-call-from-kvm/">Hooking an SGX ENCLS Leaf Function Call from KVM</a>
            <br />
            
            <a href="/2017-04-05/intel-sgx-instructions-in-enclave-initialization/">Intel SGX Instructions in Enclave Initialization</a>
            <br />
            
            <a href="/2017-04-03/intel-sgx-protection-mechanism/">Intel SGX Protection Mechanism</a>
            <br />
            
        </div>
    </div>
    
</div>
<script>
    document.addEventListener('DOMContentLoaded', ()=>{
        hljs.initHighlightingOnLoad();
    })
</script>

      </div>
    </div>
    
  </main>
  <footer class="pl-scrollbar">
    <div class="w-full max-w-screen-xl mx-auto"><div class="text-center p-6 pin-b">
    <p class="text-sm text-tertiary-text">&copy; 2017 - 2021 Insu Jang &middot;  Powered by the <a href="https://github.com/wangchucheng/hugo-eureka" class="hover:text-eureka">Eureka</a> theme for <a href="https://gohugo.io" class="hover:text-eureka">Hugo</a></p>
</div></div>
  </footer>
</body>

</html>